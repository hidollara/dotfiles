#!/bin/zsh

if [[ "$OSTYPE" == darwin* ]]; then
  local airport_path='/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport'
  local -A airport_info=($(eval $airport_path -I| grep -E '^ *(agrCtlRSSI|state|SSID):'| sed 's/:/ /'| awk '{print $1, $2}'))
  case ${airport_info[state]} in
    'running' ) echo "${airport_info[SSID]} [$(echo '▁▃▅▇'| cut -c-$((4 - (${airport_info[agrCtlRSSI]} - -60) / -10)))]" ;;
    'init' ) echo '\e[33m...\e[0m' ;;
    * ) echo '\e[31m✘\e[0m' ;;
  esac
fi
