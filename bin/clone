#!/bin/bash

tmpfile=$(mktemp) && trap "rm -f $tmpfile" EXIT
hub api -X GET /user/repos > $tmpfile
repo=$(cat $tmpfile| jq -r '.[].full_name'| fzf)

ssh -T git@github.com >&/dev/null || exitcode=$?
if [[ $exitcode == 1 ]]; then
  git clone $(cat $tmpfile| jq -r "map(select(.full_name == \"$repo\")) | .[0].ssh_url")
else
  git clone $(cat $tmpfile| jq -r "map(select(.full_name == \"$repo\")) | .[0].clone_url")
fi
