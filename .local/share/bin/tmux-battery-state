#!/bin/zsh

if [[ "$OSTYPE" == darwin* ]]; then
  local battery_info=$(/usr/bin/pmset -g ps | awk '{ if (NR == 2) print $3 " " $4 }' | sed -e "s/;//g" -e "s/%//")
  if [[ -n $battery_info ]]; then
    local battery_quantity="$(echo $battery_info | awk '{print $1}')"
    if [[ ! $battery_info =~ "discharging" ]]; then
      echo "#[fg=yellow]+ #[fg=green]$battery_quantity%#[fg=default]"
    elif (( $battery_quantity <= 20 )); then
      echo "#[fg=red]$battery_quantity%#[fg=default]"
    else
      echo "$battery_quantity%"
    fi
  fi
fi
